# Архитектура MVP проекта COOKie

> **Целевой запуск**: 20-27 января 2026
> **Временные рамки**: 14 октября 2025 - 27 января 2026 (15 недель)
> **Scope**: Минимально жизнеспособный продукт, сфокусированный на управлении рецептами
> **Команда**: Один разработчик

---

## Философия MVP: Прагматичная Простота

**Руководящие принципы**:
1. **Сначала монолит**: Начинаем с модульного монолита, а не микросервисов
2. **Управляемые сервисы**: Используем облачные управляемые сервисы для снижения операционной нагрузки
3. **Вручную, а не автоматически**: Принимаем ручные процессы там, где автоматизация сложна
4. **Только важные функции**: Выпускаем основную ценность, откладываем "приятные" дополнения
5. **Качество важнее количества**: 250 отличных рецептов > 500 посредственных

---

## Scope MVP функций

### ✅ **Включено (Обязательно)**

**Основные функции**:
- Просмотр и поиск рецептов (full-text + фильтры)
- Детальная страница рецепта с КБЖУ
- Регистрация и аутентификация пользователей (email/пароль + OAuth)
- Избранное (закладки рецептов)
- Базовая система оценок (1-5 звезд)
- Адаптивный web-интерфейс (мобильный + десктоп)

**Админ-функции**:
- Админ-панель для управления рецептами
- CRUD операции для рецептов
- Workflow модерации (черновик → опубликован)
- Инструмент пакетного импорта для LLM-генерированных рецептов

**Контент**:
- **250-300 рецептов к запуску**
- **+50 новых рецептов в неделю после запуска**
- Точные данные КБЖУ (выборочная проверка нутрициологом)
- Качественные изображения (Perplexity AI + стоковые фото)

### ❌ **Исключено (Отложено на Фазу 2)**

- ИИ-диетолог (слишком дорого для MVP)
- Планирование питания (нужен сложный алгоритм)
- Списки покупок
- B2B интеграции
- Платежи/подписки (все бесплатно для MVP)
- Геймификация
- Нативные мобильные приложения (только web, PWA позже)
- Продвинутая аналитика (используем только Google Analytics)
- Автоматический парсинг (юридические риски)

---

## Технологический Стек

**Frontend**: Next.js 14, TailwindCSS, React Context + Zustand
**Backend**: ASP.NET Core 8 (C#), Entity Framework Core, Identity
**База данных**: PostgreSQL (управляемый), Redis (управляемый)
**Хранилище**: Yandex Object Storage
**Инфраструктура**: Yandex Cloud VM (~10K ₽/месяц)
**Мониторинг**: Sentry + Google Analytics + UptimeRobot

---

## Дорожная Карта Разработки (15 Недель)

### Фаза 0: Настройка и Планирование (Недели 1-2: 14-27 окт)

**Неделя 1 (14-20 окт)**:
- [ ] Настроить аккаунт Yandex Cloud
- [ ] Создать GitHub репо (приватные)
- [ ] Настроить локальное dev окружение (.NET 8 SDK, Node.js, Docker)
- [ ] Инициализировать Next.js проект

**Неделя 2 (21-27 окт)**:
- [ ] Инициализировать ASP.NET Core 8 backend проект
- [ ] Настроить PostgreSQL + Redis локально (Docker Compose)
- [ ] Настроить Entity Framework Core
- [ ] Настроить CI/CD пайплайн (базовая настройка GitHub Actions)
- [ ] Начать создание контента (Цель: 50 рецептов к концу недели)

---

### Фаза 1: Основной Backend (Недели 3-6: 28 окт - 24 нояб)

**Неделя 3 (28 окт - 3 нояб): Recipe Module Часть 1**
- [ ] Recipe entity + EF Core модель
- [ ] Recipe CRUD API эндпоинты
- [ ] Базовая валидация
- [ ] Продолжить создание контента (Цель: 100 рецептов всего)

**Неделя 4 (4-10 нояб): Recipe Module Часть 2**
- [ ] Full-text поиск с PostgreSQL
- [ ] Логика фильтров и сортировки (кухня, время, сложность)
- [ ] Загрузка изображений в Object Storage
- [ ] Продолжить создание контента (Цель: 150 рецептов всего)

**Неделя 5 (11-17 нояб): User & Auth Module**
- [ ] User entity + EF Core модель
- [ ] JWT аутентификация с ASP.NET Core Identity
- [ ] OAuth интеграция (Yandex, VK)
- [ ] Управление профилем
- [ ] Продолжить создание контента (Цель: 200 рецептов всего)

**Неделя 6 (18-24 нояб): Рейтинги & Избранное**
- [ ] Система рейтингов (1-5 звезд)
- [ ] Логика избранного
- [ ] Агрегация (средний рейтинг, кол-во в избранном)
- [ ] Завершить основное создание контента (Цель: 250 рецептов)

---

### Фаза 2: Frontend (Недели 7-10: 25 нояб - 22 дек)

**Неделя 7 (25 нояб - 1 дек): Основные Страницы**
- [ ] Главная (hero + сетка популярных рецептов)
- [ ] Страница поиска/просмотра рецептов с фильтрами
- [ ] Детальная страница рецепта (ингредиенты, шаги, КБЖУ, рейтинги)

**Неделя 8 (2-8 дек): Функции Пользователя**
- [ ] Flow регистрации/входа
- [ ] Кнопки OAuth (Yandex, VK)
- [ ] Страница профиля
- [ ] Страница избранного с фильтрацией

**Неделя 9 (9-15 дек): Админ-панель**
- [ ] CMS рецептов (создание, редактирование, публикация)
- [ ] Инструмент пакетного импорта (CSV/JSON от LLM)
- [ ] Админ дашборд (базовая статистика)
- [ ] UI загрузки изображений

**Неделя 10 (16-22 дек): Полировка & SEO**
- [ ] Адаптивный дизайн (мобильная оптимизация)
- [ ] Состояния загрузки, обработка ошибок
- [ ] SEO оптимизация (мета-теги, OpenGraph, sitemap)
- [ ] Оптимизация производительности (ленивая загрузка изображений)

---

### Фаза 3: Контент & Тестирование (Недели 11-12: 23 дек - 5 янв)

⚠️ **Праздничный Период** - Гибкое расписание, корректировка по необходимости

**Неделя 11 (23-29 дек)**: Финализация контента, валидация КБЖУ, поиск изображений
**Неделя 12 (30 дек - 5 янв)**: Unit тесты, интеграционные тесты, ручное QA, тестирование производительности

**Резервный план**: Если недоступны во время праздников, контент уже готов (Неделя 6), тестирование может быть сжато до Недели 13

---

### Фаза 4: Предзапуск (Недели 13-14: 6-19 янв)

**Неделя 13 (6-12 янв): Развертывание & Бета**
- [ ] Развернуть на Yandex Cloud production
- [ ] Настроить домен + SSL
- [ ] Настроить мониторинг (Sentry, UptimeRobot, Google Analytics)
- [ ] Пригласить 20 бета-тестеров
- [ ] Создать форму обратной связи

**Неделя 14 (13-19 янв): Бета-тестирование & Полировка**
- [ ] Собрать фидбек от бета-тестеров
- [ ] Исправить критические баги и UX проблемы
- [ ] Оптимизация производительности на основе фидбека
- [ ] Подготовить материалы для запуска
- [ ] Написать анонс запуска

---

### Фаза 5: Публичный Запуск (Неделя 15: 20-27 янв)

**20 янв (Понедельник)**: Мягкий Запуск
- [ ] Убрать ограничения бета-приглашений
- [ ] Открыть для публики
- [ ] Мониторить ошибки и производительность

**21-22 янв (Вт-Ср)**: Маркетинговый Запуск
- [ ] Анонс в соцсетях (VK, Instagram, Telegram)
- [ ] Публикация в 10-15 VK группах о кулинарии
- [ ] Отправка на стартап-директории (vc.ru, habr.com)

**23-27 янв (Чт-Пн)**: Неделя Роста
- [ ] Ежедневный мониторинг привлечения пользователей
- [ ] Ответы на фидбек пользователей
- [ ] Исправление некритичных багов
- [ ] Отслеживание прогресса к цели 1000 пользователей

**После Запуска (Неделя 16+)**: Добавлять +50 новых рецептов в неделю, итерировать на основе фидбека

---

## Метрики Успеха

### Цели Недели Запуска (20-27 янв)

- **250 зарегистрированных пользователей** (в среднем 35/день)
- **1,000+ просмотров рецептов** (в среднем 140/день)
- **50+ ежедневно активных пользователей**
- **< 5 критических багов** сообщено
- **90%+ uptime**

### Цели Первого Месяца (К 27 фев 2026)

- **1,000 зарегистрированных пользователей**
- **15,000+ просмотров рецептов**
- **200+ ежедневно активных пользователей к концу месяца**
- **Retention D7: 25%+**
- **NPS: 40+**
- **350-400 всего рецептов** (+50/неделю)

### Когда Рассматривать Фазу 2

- ✅ 1,000+ пользователей достигнуто
- Retention D7: 30%+
- NPS: 50+
- Стабильный ежедневный рост (10-20 новых пользователей/день органически)
- Положительный фидбек на основные функции
- Нет серьезных технических проблем

---

## Стратегия Привлечения Пользователей

### Неделя 1 (20-27 янв): Цель 250 Пользователей

**Ежедневные Действия**:
- **Утро** (30мин): Публикация в 2-3 VK группах о кулинарии
- **День** (30мин): Участие в комментариях, ответы на вопросы
- **Вечер** (30мин): Публикация в личных соцсетях

**Тактики**:
1. **VK Группы** (Основной канал): Найти 50+ релевантных групп, публиковать 2-3/день
2. **Личные Сети**: Друзья в VK, истории в Instagram, Telegram
3. **Бета-тестеры**: Попросить пригласить по 2-3 друга каждого
4. **Стимул**: "Первые 500 пользователей получают бесплатный доступ к Premium навсегда"

**Ожидаемо**: 100 VK + 80 личные + 40 бета-тестеры + 30 сарафан = 250 пользователей

### Недели 2-4 (28 янв - 17 фев): Цель +400 Пользователей (650 Всего)

1. **SEO**: Страницы рецептов индексированы, длинные ключевые слова (5-10 регистраций/неделю)
2. **VK Группы**: Продолжение публикаций с данными о traction (20-30 регистраций/неделю)
3. **Реферралы Пользователей**: 20% приглашают друга = 50 больше
4. **Контент-маркетинг**: 2-3 блог-поста (10-20 регистраций)
5. **Вовлечение Сообщества**: Отвечать на вопросы в VK группах, ссылаться на рецепты

**Ожидаемо**: 150 VK + 100 SEO + 100 реферралы + 50 контент = +400 пользователей

### Недели 5+ (18-27 фев): Цель +350 Пользователей (1000 Всего)

1. **Органический Рост**: SEO улучшается (20-30 регистраций/неделю), сарафан усиливается
2. **Опциональная Реклама** (10-50K ₽): VK Ads или микро-инфлюенсеры при наличии бюджета
3. **Продолжение Всего Выше**: VK группы, контент-маркетинг, вовлечение сообщества

**Ожидаемо**: 150 органика + 200 платная (если бюджет) ИЛИ +350 вся органика = 1000 пользователей

---

## Стратегия Создания Контента

### Pipeline Генерации Рецептов

**Инструменты**:
- Claude / ChatGPT для текста рецептов
- Perplexity AI для изображений рецептов
- USDA FoodData Central для данных КБЖУ
- Google Sheets для отслеживания батчей

**Процесс На Рецепт** (~ 15-20 мин):
1. **Генерация текста** (5 мин): LLM промпт, проверка вывода
2. **Генерация изображения** (3 мин): AI генерация или стоковое фото
3. **Расчет КБЖУ** (5 мин): База USDA, выборочная проверка с нутрициологом
4. **Импорт в систему** (2 мин): Инструмент батч-импорта
5. **Проверка качества** (5 мин): Проверка на frontend

**График**:
- **Недели 2-6**: 50 рецептов/неделю (3.5 рецептов/день = 53мин/день)
- **После Запуска**: 50 рецептов/неделю (7 рецептов/день × 15мин = 105мин/день)

**Категории** (Всего: 250 рецептов):
- Завтраки: 30 | Супы: 25 | Основные блюда: 80
- Гарниры: 30 | Закуски: 30 | Десерты: 25
- Напитки/Смузи: 20 | Выпечка ПП: 10

---

## Архитектура

### Диаграмма Высокого Уровня

```
┌─────────────────────────────────────────────────────────┐
│              Пользователи (Web Browser)                  │
└─────────────────────┬───────────────────────────────────┘
                      │ HTTPS
                      ▼
┌─────────────────────────────────────────────────────────┐
│         Yandex Cloud Load Balancer                       │
└─────────────────────┬───────────────────────────────────┘
                      │
        ┌─────────────┴─────────────┐
        ▼                           ▼
┌────────────────┐          ┌────────────────┐
│   Web App      │          │   Admin Panel  │
│  (Next.js SSR) │          │   (React SPA)  │
└───────┬────────┘          └───────┬────────┘
        │                           │
        └─────────────┬─────────────┘
                      │ REST API
                      ▼
┌─────────────────────────────────────────────────────────┐
│      Backend Монолит (ASP.NET Core 8 C#)                 │
│  ┌──────────────────────────────────────────────────┐   │
│  │ Модули:                                          │   │
│  │  - Recipe Module (CRUD, Поиск, Рейтинги)        │   │
│  │  - User Module (Auth, Профили, Избранное)       │   │
│  │  - Admin Module (Модерация, CMS)                │   │
│  │  - Analytics Module (Базовые события → GA)      │   │
│  └──────────────────────────────────────────────────┘   │
└───────────────────┬──────────────┬──────────────────────┘
                    │              │
        ┌───────────┴──────┐   ┌──┴─────────────┐
        ▼                  │   │                 ▼
┌────────────────┐         │   │      ┌────────────────┐
│   PostgreSQL   │         │   │      │  Redis Cache   │
│ (Управляемый)  │         │   │      │ (Управляемый)  │
└────────────────┘         │   │      └────────────────┘
                           │   │
                           ▼   ▼
                    ┌──────────────────┐
                    │  Object Storage  │
                    │(Изображения)     │
                    └──────────────────┘
```

### Детали Технологий

**Frontend**:
- Framework: Next.js 14 (App Router)
- Styling: TailwindCSS
- State Management: React Context + Zustand
- HTTP Client: Axios
- Form Handling: React Hook Form + Zod validation

**Backend**:
- Framework: ASP.NET Core 8 (C#)
- ORM: Entity Framework Core 8
- Validation: FluentValidation
- Authentication: ASP.NET Core Identity (JWT + OAuth)
- File Upload: IFormFile с custom middleware

**База Данных**:
- Primary DB: Yandex Managed PostgreSQL (2 vCPU, 4GB RAM, 50GB SSD)
- Cache: Yandex Managed Redis (1 vCPU, 2GB RAM)
- File Storage: Yandex Object Storage (S3-совместимый, 100GB)

**Инфраструктура**:
- Cloud: Yandex Cloud
- Compute: VM инстансы (2 vCPU, 4GB RAM)
- Load Balancer: Yandex Application Load Balancer
- DNS: Yandex Cloud DNS
- SSL: Let's Encrypt (бесплатно)

**Мониторинг**:
- Errors: Sentry (free tier: 5K событий/месяц)
- Analytics: Google Analytics 4
- Uptime: UptimeRobot (free tier)
- Logs: Yandex Cloud Logging (базовый)

**CI/CD**:
- Version Control: GitHub (приватные репо)
- CI/CD: GitHub Actions
- Deployment: Docker контейнеры на Yandex Compute Cloud

---

## Схема Базы Данных

### Основные Таблицы

**users**
```sql
id, email, password_hash, username, first_name, avatar_url,
oauth_provider, oauth_id, email_verified, created_at
```

**recipes**
```sql
id, slug, title, description, cuisine, difficulty,
prep_time_minutes, cook_time_minutes, total_time_minutes, servings,
instructions (JSONB), nutrition_per_serving (JSONB),
dietary_tags, allergens, image_urls,
rating_avg, rating_count, view_count, favorite_count,
status, created_at, updated_at
```

**user_favorites**
```sql
user_id (FK), recipe_id (FK), created_at
PRIMARY KEY (user_id, recipe_id)
```

**user_ratings**
```sql
id, user_id (FK), recipe_id (FK), rating (1-5), review, created_at
UNIQUE (user_id, recipe_id)
```

**sessions**
```sql
id, user_id (FK), refresh_token, expires_at, created_at
```

### Индексы (Критичные для Производительности)

```sql
-- Recipes
CREATE INDEX idx_recipes_slug ON recipes(slug);
CREATE INDEX idx_recipes_status ON recipes(status);
CREATE INDEX idx_recipes_cuisine ON recipes(cuisine);
CREATE INDEX idx_recipes_rating ON recipes(rating_avg DESC, rating_count DESC);
CREATE INDEX idx_recipes_popularity ON recipes(view_count DESC, favorite_count DESC);
CREATE INDEX idx_recipes_total_time ON recipes(total_time_minutes);
CREATE INDEX idx_recipes_dietary_tags ON recipes USING GIN(dietary_tags);
CREATE INDEX idx_recipes_fulltext ON recipes USING GIN(to_tsvector('russian', title || ' ' || description));

-- Users
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_oauth ON users(oauth_provider, oauth_id);

-- Favorites
CREATE INDEX idx_favorites_user ON user_favorites(user_id);
CREATE INDEX idx_favorites_recipe ON user_favorites(recipe_id);

-- Ratings
CREATE INDEX idx_ratings_recipe ON user_ratings(recipe_id);
CREATE INDEX idx_ratings_user ON user_ratings(user_id);
```

---

## Дизайн API

### Публичные Эндпоинты (Без Auth)

```
GET /api/v1/recipes                    # Поиск/просмотр рецептов
GET /api/v1/recipes/:slug              # Получить детали рецепта
GET /api/v1/recipes/popular            # Топ 20 популярных рецептов
GET /api/v1/recipes/cuisines           # Список кухонь
GET /health                            # Health check
```

### Аутентифицированные Эндпоинты (JWT Требуется)

**Auth**:
```
POST /api/v1/auth/register             # Регистрация с email
POST /api/v1/auth/login                # Вход
POST /api/v1/auth/refresh              # Обновить access token
POST /api/v1/auth/logout               # Выход
GET  /api/v1/auth/oauth/:provider      # OAuth flow (Yandex, VK)
```

**User**:
```
GET  /api/v1/users/me                  # Получить профиль текущего пользователя
PATCH /api/v1/users/me                 # Обновить профиль
```

**Favorites**:
```
GET /api/v1/users/me/favorites         # Получить избранное пользователя
POST /api/v1/recipes/:id/favorite      # Добавить в избранное
DELETE /api/v1/recipes/:id/favorite    # Убрать из избранного
```

**Ratings**:
```
POST /api/v1/recipes/:id/rating        # Оценить рецепт
PATCH /api/v1/recipes/:id/rating       # Обновить оценку
DELETE /api/v1/recipes/:id/rating      # Удалить оценку
```

### Админ Эндпоинты (Требуется Админ Роль)

```
POST /api/v1/admin/recipes             # Создать рецепт
PATCH /api/v1/admin/recipes/:id        # Обновить рецепт
DELETE /api/v1/admin/recipes/:id       # Удалить рецепт
POST /api/v1/admin/recipes/:id/publish # Опубликовать рецепт
GET /api/v1/admin/stats                # Статистика дашборда
```

---

## Развертывание

### Стоимость Инфраструктуры (MVP): ~10,000 ₽/месяц

- Compute: ~2,500 ₽/месяц (1 VM)
- PostgreSQL: ~4,000 ₽/месяц (управляемый)
- Redis: ~1,500 ₽/месяц (управляемый)
- Object Storage: ~300 ₽/месяц (100GB)
- Load Balancer: ~1,000 ₽/месяц
- Backup: ~500 ₽/месяц (ежедневно, хранение 7 дней)

### Процесс Развертывания

1. Локальная разработка (Docker Compose для DB)
2. Push в GitHub (feature branch)
3. GitHub Actions запускает тесты
4. Merge в main → автоматическое развертывание в production
5. Docker образ собирается и отправляется в Yandex Container Registry
6. SSH на VM, pull нового образа, перезапуск контейнеров
7. Запуск миграций базы данных
8. Health check

---

## Оценка Рисков

| Риск | Влияние | Митигация | Статус |
|------|---------|-----------|--------|
| Задержки solo dev | Высокое | 15-недельный таймлайн с 1-недельным буфером | Смягчен |
| Узкое место создания контента | Высокое | 250 рецептов (не 500), четкий пайплайн, 15-20 мин/рецепт | Смягчен |
| Сбой из-за праздников | Среднее | Недели 11-12 гибкие, контент готов к Неделе 6 | Смягчен |
| Низкое вовлечение пользователей | Критическое | Бета-тестирование, итерация по фидбеку, стратегия 1000 пользователей | В процессе |
| Технические проблемы при запуске | Высокое | Тщательное тестирование Недели 12-14, поэтапный запуск | В процессе |
| Не достичь 1000 пользователей | Высокое | Детальная ежедневная тактика, VK группы, SEO, реферралы | Смягчен |
| Превышение бюджета инфраструктуры | Среднее | Ежедневный мониторинг, оптимизация запросов, CDN для изображений | В процессе |

**Общий Уровень Риска**: **НИЗКИЙ-СРЕДНИЙ**

---

## Следующие Немедленные Шаги

1. **Настроить Yandex Cloud** (1 час): Регистрация, добавление способа оплаты, ознакомление с консолью
2. **Создать GitHub репо** (30 мин): Приватные репо, защита веток
3. **Настроить локальную разработку** (2 часа): .NET 8 SDK, Node.js, Docker, docker-compose.yml
4. **Сгенерировать первые 10 рецептов** (3 часа): Тестирование LLM промпта, доработка процесса
5. **Спланировать недельное расписание** (1 час): Выделить время для разработки и создания контента

**Всего времени на этой неделе**: ~7.5 часов

---

## Еженедельные Контрольные Точки

**Неделя 2**: ✅ 50 рецептов сгенерировано
**Неделя 4**: ✅ Backend API работает (recipes CRUD)
**Неделя 6**: ✅ 250 рецептов в базе данных
**Неделя 8**: ✅ Frontend страницы работают
**Неделя 10**: ✅ Полный UX flow работает
**Неделя 12**: ✅ Тестирование завершено
**Неделя 14**: ✅ Бета-тестирование завершено
**Неделя 15**: ✅ Публичный запуск

---

## Дорожная Карта После Запуска

### Фаза 2: Рост & Итерация (Фев - Мар)
- Добавлять 50 рецептов/неделю (достичь 500+ к концу марта)
- Итерировать на основе фидбека пользователей
- Достичь milestone 5,000 пользователей

### Фаза 3: Premium Функции (Апр - Май)
- Реализовать алгоритм планирования питания
- Интегрировать OpenAI для ИИ-диетолога
- Добавить платежи (YooKassa)
- Запустить Premium тарифы (399₽/месяц)

### Фаза 4: B2B Партнерства (Июнь+)
- Связаться с X5 Group, ВкусВилл с данными о traction
- Переговоры по партнерским интеграциям
- Запуск Pro тарифа с интеграцией доставки

---

**Готово к разработке!**
